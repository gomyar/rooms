#!/usr/bin/env python

from gevent import monkey
monkey.patch_all()

from flask import Flask
from flask import redirect

from rooms.flask.login import bp_login
from rooms.flask.login import init_login
from rooms.flask.master import bp_master
from rooms.flask.node import bp_node
from rooms.flask.app import node
from rooms.flask.app import master
from rooms.flask.app import container

from flask_login import login_required
import flask_login

app = Flask(__name__)
app.secret_key = 'keepitsecretkeepitsafe'

@app.route("/")
def index():
    return "Index"


@app.route("/join/<game_id>")
@login_required
def join(game_id):
    # default implementation
    master.join_game(game_id, flask_login.current_user.get_id())



if __name__ == '__main__':
    init_login(app)
    app.register_blueprint(bp_login)
    app.register_blueprint(bp_master)
    app.register_blueprint(bp_node)

    node.start()

    app.run()
